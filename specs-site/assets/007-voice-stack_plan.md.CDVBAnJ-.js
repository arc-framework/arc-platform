import{_ as k,C as d,o as e,c as o,an as p,b as n,w as i,a,E as l,ao as h,j as r}from"./chunks/framework.CTqRDTHW.js";const A=JSON.parse('{"title":"Implementation Plan: Realtime Voice Infrastructure Setup","description":"","frontmatter":{},"headers":[],"relativePath":"007-voice-stack/plan.md","filePath":"007-voice-stack/plan.md","lastUpdated":1772310733000}'),c={name:"007-voice-stack/plan.md"};function E(g,s,y,m,F,u){const t=d("Mermaid");return e(),o("div",null,[s[4]||(s[4]=p('<p>&lt;div style=&quot;display: none;&quot; hidden=&quot;true&quot; aria-hidden=&quot;true&quot;&gt;Are you an LLM? You can read better optimized documentation at /arc-platform/specs-site/007-voice-stack/plan.md for this page in Markdown format&lt;/div&gt;</p><h1 id="implementation-plan-realtime-voice-infrastructure-setup" tabindex="-1">Implementation Plan: Realtime Voice Infrastructure Setup <a class="header-anchor" href="#implementation-plan-realtime-voice-infrastructure-setup" aria-label="Permalink to &quot;Implementation Plan: Realtime Voice Infrastructure Setup&quot;">​</a></h1><blockquote><p><strong>Spec</strong>: 007-voice-stack <strong>Date</strong>: 2026-03-01</p></blockquote><h2 id="summary" tabindex="-1">Summary <a class="header-anchor" href="#summary" aria-label="Permalink to &quot;Summary&quot;">​</a></h2><p>Add three co-located realtime services — LiveKit Server (Daredevil), LiveKit Ingress (Sentry), LiveKit Egress (Scribe) — all in <code>services/realtime/</code> following the thin-wrapper pattern from 003/005/006: Dockerfiles with OCI labels, shared <code>docker-compose.yml</code>, <code>service.yaml</code>, <code>realtime.mk</code> aggregate, CI/release workflows. All three join <code>arc_platform_net</code>; <code>realtime</code> added to <code>think</code>, <code>reason</code> profiles. Sentry and Scribe depend on Daredevil and are always started as a unit via the shared compose. Static dev API keys (<code>devkey</code>/<code>devsecret</code>) are used in config files; vault integration is deferred.</p><h2 id="target-modules" tabindex="-1">Target Modules <a class="header-anchor" href="#target-modules" aria-label="Permalink to &quot;Target Modules&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Module</th><th>Language</th><th>Changes</th></tr></thead><tbody><tr><td><code>services/realtime/</code></td><td>Config/Dockerfile</td><td>New — 3 Dockerfiles, shared compose, 3 config YAMLs, service.yaml, realtime.mk</td></tr><tr><td><code>services/profiles.yaml</code></td><td>YAML</td><td>Add <code>realtime</code> to <code>think</code> and <code>reason</code> profiles</td></tr><tr><td><code>.github/workflows/</code></td><td>YAML</td><td>New — realtime-images.yml + realtime-release.yml</td></tr><tr><td><code>Makefile</code></td><td>Make</td><td>Include <code>services/realtime/realtime.mk</code></td></tr><tr><td><code>scripts/scripts.mk</code></td><td>Make</td><td>Add realtime build/publish targets to <code>publish-all</code></td></tr><tr><td><code>scripts/lib/check-dev-prereqs.sh</code></td><td>Bash</td><td>Add ports 7880, 7881, 1935 to prerequisite checks</td></tr></tbody></table><h2 id="technical-context" tabindex="-1">Technical Context <a class="header-anchor" href="#technical-context" aria-label="Permalink to &quot;Technical Context&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Aspect</th><th>Value</th></tr></thead><tbody><tr><td>Language</td><td>Config-only (YAML, Dockerfile, Makefile) — no application code</td></tr><tr><td>Base Images</td><td><code>livekit/livekit-server</code>, <code>livekit/ingress</code>, <code>livekit/egress</code></td></tr><tr><td>Testing</td><td>HTTP GET :7880 (Daredevil), :7888 (Sentry), :7889 (Scribe)</td></tr><tr><td>Network</td><td><code>arc_platform_net</code> (external bridge, pre-existing)</td></tr><tr><td>Volumes</td><td>None — stateless in dev; Egress writes recordings to arc-storage over S3</td></tr><tr><td>CI Pattern</td><td>Mirror <code>control-images.yml</code> — amd64-only CI, dorny/paths-filter; single path <code>services/realtime/**</code></td></tr><tr><td>Root handling</td><td>Verify per image; document deviation in Dockerfile if root required</td></tr><tr><td>Key config</td><td>Static <code>devkey</code>/<code>devsecret</code> in YAML config files mounted read-only</td></tr></tbody></table><h2 id="architecture" tabindex="-1">Architecture <a class="header-anchor" href="#architecture" aria-label="Permalink to &quot;Architecture&quot;">​</a></h2><h3 id="service-topology" tabindex="-1">Service topology <a class="header-anchor" href="#service-topology" aria-label="Permalink to &quot;Service topology&quot;">​</a></h3>',11)),(e(),n(h,null,{default:i(()=>[l(t,{id:"mermaid-190",class:"mermaid",graph:"graph%20TB%0A%20%20%20%20subgraph%20Host%0A%20%20%20%20%20%20%20%20subgraph%20arc_platform_net%0A%20%20%20%20%20%20%20%20%20%20%20%20realtime%5B%22arc-realtime%5Cnlivekit%2Flivekit-server%5Cn%3A7880%20HTTP%2Fsignal%5Cn%3A7881%20gRPC%5Cn%3A7882%20TURN%2FTCP%5Cn%3A50100-50200%2FUDP%20RTP%22%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20ingress%5B%22arc-realtime-ingress%5Cnlivekit%2Fingress%5Cn%3A7888%20controller%5Cn%3A1935%20RTMP%22%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20egress%5B%22arc-realtime-egress%5Cnlivekit%2Fegress%5Cn%3A7889%20controller%22%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20cache%5B%22arc-cache%5CnRedis%5Cn%3A6379%22%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20storage%5B%22arc-storage%5CnMinIO%5Cn%3A9000%22%5D%0A%20%20%20%20%20%20%20%20end%0A%20%20%20%20end%0A%0A%20%20%20%20webrtc%5B%22WebRTC%20Clients%22%5D%20--%3E%7C7880%20signal%7C%20realtime%0A%20%20%20%20rtmp%5B%22RTMP%20Sources%22%5D%20--%3E%7C1935%20RTMP%7C%20ingress%0A%20%20%20%20ingress%20--%3E%7Cws%3A%2F%2Farc-realtime%3A7880%7C%20realtime%0A%20%20%20%20egress%20--%3E%7Crealtime%20API%20%3A7880%7C%20realtime%0A%20%20%20%20egress%20--%3E%7CS3%20recordings%7C%20storage%0A%20%20%20%20realtime%20--%3E%7Cpub%2Fsub%20state%7C%20cache%0A%20%20%20%20realtime%20-.-%3E%7C%2250100-50200%2FUDP%20RTP%5Cn(0.0.0.0%20%E2%80%94%20NAT%20traversal)%22%7C%20webrtc%0A"})]),fallback:i(()=>[...s[0]||(s[0]=[a(" Loading... ",-1)])]),_:1})),s[5]||(s[5]=r("h3",{id:"port-binding-strategy",tabindex:"-1"},[a("Port binding strategy "),r("a",{class:"header-anchor",href:"#port-binding-strategy","aria-label":'Permalink to "Port binding strategy"'},"​")],-1)),(e(),n(h,null,{default:i(()=>[l(t,{id:"mermaid-194",class:"mermaid",graph:"graph%20LR%0A%20%20%20%20subgraph%20%22TCP%20%E2%80%94%20127.0.0.1%20only%22%0A%20%20%20%20%20%20%20%20p7880%5B%22Host%20%3A7880%20%E2%86%92%20container%20%3A7880%5CnLiveKit%20HTTP%20%2B%20signalling%22%5D%0A%20%20%20%20%20%20%20%20p7881%5B%22Host%20%3A7881%20%E2%86%92%20container%20%3A7881%5CngRPC%20API%22%5D%0A%20%20%20%20%20%20%20%20p7882%5B%22Host%20%3A7882%20%E2%86%92%20container%20%3A7882%5CnTURN%2FTCP%22%5D%0A%20%20%20%20%20%20%20%20p7888%5B%22Host%20%3A7888%20%E2%86%92%20container%20%3A7888%5CnIngress%20controller%22%5D%0A%20%20%20%20%20%20%20%20p1935%5B%22Host%20%3A1935%20%E2%86%92%20container%20%3A1935%5CnRTMP%20ingest%22%5D%0A%20%20%20%20%20%20%20%20p7889%5B%22Host%20%3A7889%20%E2%86%92%20container%20%3A7889%5CnEgress%20controller%22%5D%0A%20%20%20%20end%0A%20%20%20%20subgraph%20%22UDP%20%E2%80%94%200.0.0.0%20(WebRTC%20exception)%22%0A%20%20%20%20%20%20%20%20pudp%5B%22Host%20%3A50100-50200%20%E2%86%92%20container%20%3A50100-50200%5CnWebRTC%20RTP%20media%5CnClients%20outside%20Docker%20need%20direct%20reach%22%5D%0A%20%20%20%20end%0A"})]),fallback:i(()=>[...s[1]||(s[1]=[a(" Loading... ",-1)])]),_:1})),s[6]||(s[6]=r("h3",{id:"file-pattern-co-located-variant",tabindex:"-1"},[a("File pattern (co-located variant) "),r("a",{class:"header-anchor",href:"#file-pattern-co-located-variant","aria-label":'Permalink to "File pattern (co-located variant)"'},"​")],-1)),(e(),n(h,null,{default:i(()=>[l(t,{id:"mermaid-198",class:"mermaid",graph:"graph%20TD%0A%20%20%20%20A%5B%22services%2Frealtime%2F%22%5D%20--%3E%20B%5B%22Dockerfile%5CnFROM%20livekit%2Flivekit-server%5Cnarc-realtime%22%5D%0A%20%20%20%20A%20--%3E%20C%5B%22Dockerfile.ingress%5CnFROM%20livekit%2Fingress%5Cnarc-realtime-ingress%22%5D%0A%20%20%20%20A%20--%3E%20D%5B%22Dockerfile.egress%5CnFROM%20livekit%2Fegress%5Cnarc-realtime-egress%22%5D%0A%20%20%20%20A%20--%3E%20E%5B%22livekit.yaml%5Cnkeys%2C%20redis%2C%20RTC%20ports%5CnLIVEKIT_NODE_IP%20env%22%5D%0A%20%20%20%20A%20--%3E%20F%5B%22ingress.yaml%5Cnapi_url%2C%20key%2Fsecret%5Cn%3A7888%20health%20port%22%5D%0A%20%20%20%20A%20--%3E%20G%5B%22egress.yaml%5Cnapi_url%2C%20key%2Fsecret%5CnS3%20endpoint%20%E2%86%92%20arc-storage%22%5D%0A%20%20%20%20A%20--%3E%20H%5B%22docker-compose.yml%5Cn3%20services%2C%20shared%20network%5Cndepends_on%20ordering%22%5D%0A%20%20%20%20A%20--%3E%20I%5B%22service.yaml%5Cnrole%3A%20realtime%2C%20codename%3A%20daredevil%5Cndepends_on%3A%20cache%22%5D%0A%20%20%20%20A%20--%3E%20J%5B%22realtime.mk%5Cnrealtime-*%20%2B%20ingress-*%20%2B%20egress-*%22%5D%0A"})]),fallback:i(()=>[...s[2]||(s[2]=[a(" Loading... ",-1)])]),_:1})),s[7]||(s[7]=p(`<h2 id="key-implementation-decisions" tabindex="-1">Key Implementation Decisions <a class="header-anchor" href="#key-implementation-decisions" aria-label="Permalink to &quot;Key Implementation Decisions&quot;">​</a></h2><h3 id="_1-daredevil-—-livekit-server-config" tabindex="-1">1. Daredevil — LiveKit Server config <a class="header-anchor" href="#_1-daredevil-—-livekit-server-config" aria-label="Permalink to &quot;1. Daredevil — LiveKit Server config&quot;">​</a></h3><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># services/realtime/livekit.yaml</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">7880</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">grpc_port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">7881</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">rtc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  tcp_port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">7882</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  udp_port_range_start</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50100</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  udp_port_range_end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50200</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  use_external_ip</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  node_ip</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${LIVEKIT_NODE_IP:-127.0.0.1}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">redis</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  address</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">arc-cache:6379</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">keys</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  devkey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">devsecret</span></span></code></pre></div><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># services/realtime/docker-compose.yml (arc-realtime service)</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">arc-realtime</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ghcr.io/arc-framework/arc-realtime:latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">services/realtime</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    dockerfile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Dockerfile</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  command</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">--config /etc/livekit.yaml</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./services/realtime/livekit.yaml:/etc/livekit.yaml:ro</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;127.0.0.1:7880:7880&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;127.0.0.1:7881:7881&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;127.0.0.1:7882:7882&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0.0.0.0:50100-50200:50100-50200/udp&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # WebRTC RTP — NAT traversal requires 0.0.0.0</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  environment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    LIVEKIT_NODE_IP</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${LIVEKIT_NODE_IP:-127.0.0.1}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  depends_on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    arc-cache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      condition</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">service_healthy</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  healthcheck</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;CMD-SHELL&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;wget -qO- http://localhost:7880 || exit 1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    interval</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">5s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    timeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">3s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    retries</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    start_period</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">10s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  networks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">arc_platform_net</span></span></code></pre></div><p><strong>Note</strong>: <code>--config /etc/livekit.yaml</code> passes the full config as a file; environment variable <code>LIVEKIT_NODE_IP</code> is interpolated at compose startup for the node IP. If <code>wget</code> is absent, fall back to <code>curl -sf</code>.</p><h3 id="_2-sentry-—-ingress-config" tabindex="-1">2. Sentry — Ingress config <a class="header-anchor" href="#_2-sentry-—-ingress-config" aria-label="Permalink to &quot;2. Sentry — Ingress config&quot;">​</a></h3><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># services/realtime/ingress.yaml</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">api_url</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ws://arc-realtime:7880</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">api_key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">devkey</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">api_secret</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">devsecret</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">health_port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">7888</span></span></code></pre></div><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># arc-realtime-ingress in docker-compose.yml</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">arc-realtime-ingress</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ghcr.io/arc-framework/arc-realtime-ingress:latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">services/realtime</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    dockerfile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Dockerfile.ingress</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./services/realtime/ingress.yaml:/etc/ingress.yaml:ro</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;127.0.0.1:7888:7888&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;127.0.0.1:1935:1935&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  depends_on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    arc-realtime</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      condition</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">service_healthy</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  healthcheck</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;CMD-SHELL&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;wget -qO- http://localhost:7888 || exit 1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    interval</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">5s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    timeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">3s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    retries</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    start_period</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">10s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  networks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">arc_platform_net</span></span></code></pre></div><h3 id="_3-scribe-—-egress-config" tabindex="-1">3. Scribe — Egress config <a class="header-anchor" href="#_3-scribe-—-egress-config" aria-label="Permalink to &quot;3. Scribe — Egress config&quot;">​</a></h3><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># services/realtime/egress.yaml</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">api_url</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ws://arc-realtime:7880</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">api_key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">devkey</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">api_secret</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">devsecret</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># S3-compatible output (arc-storage / MinIO)</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">s3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  endpoint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">http://arc-storage:9000</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  bucket</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">recordings</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  access_key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">arc</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  secret</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">arc-minio-dev</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  force_path_style</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">health_port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">7889</span></span></code></pre></div><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># arc-realtime-egress in docker-compose.yml</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">arc-realtime-egress</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ghcr.io/arc-framework/arc-realtime-egress:latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">services/realtime</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    dockerfile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Dockerfile.egress</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./services/realtime/egress.yaml:/etc/egress.yaml:ro</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;127.0.0.1:7889:7889&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  depends_on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    arc-realtime</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      condition</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">service_healthy</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  healthcheck</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;CMD-SHELL&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;wget -qO- http://localhost:7889 || exit 1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    interval</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">5s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    timeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">3s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    retries</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    start_period</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">10s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  networks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">arc_platform_net</span></span></code></pre></div><p><strong>Note</strong>: Scribe doesn&#39;t hard-depend on <code>arc-storage</code> in compose (storage optional for dev; egress falls back gracefully for recording requests). This matches the spec edge case: egress starts, recording requests fail until storage is healthy.</p><h3 id="_4-non-root-handling" tabindex="-1">4. Non-root handling <a class="header-anchor" href="#_4-non-root-handling" aria-label="Permalink to &quot;4. Non-root handling&quot;">​</a></h3><p>LiveKit images (server, ingress, egress) are Go binaries. Check each image&#39;s effective user:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --entrypoint</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> livekit/livekit-server</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --entrypoint</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> livekit/ingress</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --entrypoint</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> livekit/egress</span></span></code></pre></div><ul><li>If non-root already → add <code>USER</code> line in Dockerfile for clarity; no extra steps</li><li>If root → document deviation in Dockerfile comment (same pattern as Nick Fury): <em>&quot;livekit/livekit-server runs as root by default. This is a DEVELOPMENT-ONLY service. For production, build with non-root user.&quot;</em></li></ul><h3 id="_5-realtime-mk-—-multi-image-mk-design" tabindex="-1">5. realtime.mk — multi-image .mk design <a class="header-anchor" href="#_5-realtime-mk-—-multi-image-mk-design" aria-label="Permalink to &quot;5. realtime.mk — multi-image .mk design&quot;">​</a></h3><p>Three Dockerfiles in one directory means the <code>.mk</code> handles three build targets:</p><div class="language-makefile vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">makefile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">COMPOSE_REALTIME     := docker compose -f services/realtime/docker-compose.yml</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">REALTIME_IMAGE       := </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">$(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">REGISTRY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">$(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ORG</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/arc-realtime</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">REALTIME_INGRESS_IMG := </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">$(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">REGISTRY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">$(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ORG</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/arc-realtime-ingress</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">REALTIME_EGRESS_IMG  := </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">$(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">REGISTRY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">$(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ORG</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/arc-realtime-egress</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">realtime-up</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:   </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">$(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">COMPOSE_REALTIME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> up -d arc-realtime arc-realtime-ingress arc-realtime-egress</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">realtime-down</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">$(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">COMPOSE_REALTIME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> down</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">realtime-health</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: check arc-realtime :7880 + arc-realtime-ingress :7888 + arc-realtime-egress :7889</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">realtime-build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:         </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># builds arc-realtime (Dockerfile)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">realtime-ingress-build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># builds arc-realtime-ingress (Dockerfile.ingress)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">realtime-egress-build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># builds arc-realtime-egress (Dockerfile.egress)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">realtime-publish</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:         realtime-build + realtime-push</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">realtime-ingress-publish</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: realtime-ingress-build + realtime-ingress-push</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">realtime-egress-publish</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:  realtime-egress-build + realtime-egress-push</span></span></code></pre></div><p>Individual <code>realtime-ingress-up</code> and <code>realtime-egress-up</code> start only those services (useful for dev restart without cycling all three).</p><h3 id="_6-ci-cd-—-single-path-filter-three-build-jobs" tabindex="-1">6. CI/CD — single path filter, three build jobs <a class="header-anchor" href="#_6-ci-cd-—-single-path-filter-three-build-jobs" aria-label="Permalink to &quot;6. CI/CD — single path filter, three build jobs&quot;">​</a></h3><p><code>realtime-images.yml</code> — one path trigger (<code>services/realtime/**</code>), three parallel build steps:</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    branches</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    paths</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;services/realtime/**&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">jobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  build-realtime</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:       </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># builds arc-realtime</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  build-realtime-ingress</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># builds arc-realtime-ingress</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  build-realtime-egress</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># builds arc-realtime-egress</span></span></code></pre></div><p><code>realtime-release.yml</code> — tag format <code>realtime/vX.Y.Z</code> → Docker tag <code>realtime-vX.Y.Z</code>; multi-platform amd64 + arm64.</p><h3 id="_7-profiles-yaml-update" tabindex="-1">7. profiles.yaml update <a class="header-anchor" href="#_7-profiles-yaml-update" aria-label="Permalink to &quot;7. profiles.yaml update&quot;">​</a></h3><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">think</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">messaging</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">cache</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">streaming</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">friday-collector</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">cortex</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">sql-db</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">vector-db</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">gateway</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">realtime</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ← ADD: voice/WebRTC infrastructure</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">reason</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">cortex</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">messaging</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">streaming</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">cache</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">otel</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">storage</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">vault</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">flags</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">realtime</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ← ADD: voice/WebRTC infrastructure</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ultra-instinct: &#39;*&#39; — already includes all services; no change needed</span></span></code></pre></div><h3 id="_8-service-yaml-—-primary-service-only" tabindex="-1">8. service.yaml — primary service only <a class="header-anchor" href="#_8-service-yaml-—-primary-service-only" aria-label="Permalink to &quot;8. service.yaml — primary service only&quot;">​</a></h3><p><code>service.yaml</code> represents the primary service (Daredevil). Sentry and Scribe are referenced in <code>docker-compose.yml</code> depends_on but not in a separate <code>service.yaml</code>:</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">arc-realtime</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">codename</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">daredevil</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">role</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">realtime</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ghcr.io/arc-framework/arc-realtime:latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">tech</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">livekit</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">upstream</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">livekit/livekit-server</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - { </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">7880</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">protocol</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">description</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;LiveKit API + WebRTC signalling&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - { </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">7881</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">protocol</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">grpc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">description</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;gRPC API&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - { </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">7882</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">protocol</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">tcp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">description</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;TURN/TCP&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - { </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;50100-50200&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">protocol</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">udp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">description</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;WebRTC RTP media&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">health</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  endpoint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">http://localhost:7880</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  interval</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">5s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">depends_on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">cache</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Redis — multi-node pub/sub state</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">sidecars</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - { </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">arc-realtime-ingress</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">codename</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">sentry</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">7888</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">description</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;RTMP ingest&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - { </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">arc-realtime-egress</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">codename</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">scribe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">7889</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">description</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Recording + export&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span></code></pre></div><h2 id="constitution-check" tabindex="-1">Constitution Check <a class="header-anchor" href="#constitution-check" aria-label="Permalink to &quot;Constitution Check&quot;">​</a></h2><table tabindex="0"><thead><tr><th>#</th><th>Principle</th><th>Status</th><th>Evidence</th></tr></thead><tbody><tr><td>I</td><td>Zero-Dep CLI</td><td>N/A</td><td>No CLI changes</td></tr><tr><td>II</td><td>Platform-in-a-Box</td><td>PASS</td><td><code>make realtime-up</code> boots all three; joined to <code>think</code> (minimal) profile</td></tr><tr><td>III</td><td>Modular Services</td><td>PASS</td><td>Self-contained in <code>services/realtime/</code>; own service.yaml, compose, .mk</td></tr><tr><td>IV</td><td>Two-Brain</td><td>PASS</td><td>Config-only upstream images — no Python or Go custom code</td></tr><tr><td>V</td><td>Polyglot Standards</td><td>PASS</td><td>Same Dockerfile/compose/healthcheck/CI structure as 003/005/006</td></tr><tr><td>VI</td><td>Local-First</td><td>N/A</td><td>CLI only</td></tr><tr><td>VII</td><td>Observability</td><td>PASS</td><td>HTTP health endpoints :7880/:7888/:7889; Docker healthchecks</td></tr><tr><td>VIII</td><td>Security</td><td>PASS†</td><td>TCP 127.0.0.1; UDP 0.0.0.0 exception documented; no secrets in git; non-root verified per image</td></tr><tr><td>IX</td><td>Declarative</td><td>N/A</td><td>CLI only</td></tr><tr><td>X</td><td>Stateful Ops</td><td>N/A</td><td>CLI only</td></tr><tr><td>XI</td><td>Resilience</td><td>PASS</td><td><code>depends_on</code> ordering: cache → realtime → ingress/egress; start_periods for healthchecks</td></tr><tr><td>XII</td><td>Interactive</td><td>N/A</td><td>CLI only</td></tr></tbody></table><p>†<strong>Security note</strong>: UDP <code>0.0.0.0:50100-50200</code> is a documented, intentional exception required for WebRTC NAT traversal. All other ports bind <code>127.0.0.1</code>.</p><h2 id="project-structure" tabindex="-1">Project Structure <a class="header-anchor" href="#project-structure" aria-label="Permalink to &quot;Project Structure&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>arc-platform/</span></span>
<span class="line"><span>├── services/</span></span>
<span class="line"><span>│   ├── realtime/                               ← NEW (entire directory)</span></span>
<span class="line"><span>│   │   ├── Dockerfile                          # FROM livekit/livekit-server; OCI + arc labels; non-root verify</span></span>
<span class="line"><span>│   │   ├── Dockerfile.ingress                  # FROM livekit/ingress; OCI + arc labels</span></span>
<span class="line"><span>│   │   ├── Dockerfile.egress                   # FROM livekit/egress; OCI + arc labels</span></span>
<span class="line"><span>│   │   ├── livekit.yaml                        # LiveKit server config; devkey/devsecret; Redis; RTC ports</span></span>
<span class="line"><span>│   │   ├── ingress.yaml                        # Ingress config; api_url ws://arc-realtime:7880; health :7888</span></span>
<span class="line"><span>│   │   ├── egress.yaml                         # Egress config; api_url; S3 → arc-storage; health :7889</span></span>
<span class="line"><span>│   │   ├── docker-compose.yml                  # All 3 services; arc_platform_net external; depends_on</span></span>
<span class="line"><span>│   │   ├── service.yaml                        # role: realtime, codename: daredevil, depends_on: cache, sidecars</span></span>
<span class="line"><span>│   │   └── realtime.mk                         # realtime-* + realtime-ingress-* + realtime-egress-* targets</span></span>
<span class="line"><span>│   └── profiles.yaml                           # MODIFY — think += realtime; reason += realtime</span></span>
<span class="line"><span>├── .github/workflows/</span></span>
<span class="line"><span>│   ├── realtime-images.yml                     ← NEW</span></span>
<span class="line"><span>│   └── realtime-release.yml                    ← NEW</span></span>
<span class="line"><span>├── Makefile                                    # MODIFY — include services/realtime/realtime.mk</span></span>
<span class="line"><span>└── scripts/</span></span>
<span class="line"><span>    ├── scripts.mk                              # MODIFY — add realtime/ingress/egress to publish-all</span></span>
<span class="line"><span>    └── lib/</span></span>
<span class="line"><span>        └── check-dev-prereqs.sh                # MODIFY — add ports 7880, 7881, 1935</span></span></code></pre></div><h2 id="parallel-execution-strategy" tabindex="-1">Parallel Execution Strategy <a class="header-anchor" href="#parallel-execution-strategy" aria-label="Permalink to &quot;Parallel Execution Strategy&quot;">​</a></h2>`,35)),(e(),n(h,null,{default:i(()=>[l(t,{id:"mermaid-474",class:"mermaid",graph:"gantt%0A%20%20%20%20title%20007-voice-stack%20Implementation%20Phases%0A%20%20%20%20dateFormat%20X%0A%20%20%20%20axisFormat%20%25s%0A%0A%20%20%20%20section%20Phase%201%20%E2%80%94%20Foundation%0A%20%20%20%20Update%20profiles.yaml%20(realtime%20%E2%86%92%20think%20%2B%20reason)%20%20%20%20%3Ap1%2C%200%2C%201%0A%0A%20%20%20%20section%20Phase%202%20%E2%80%94%20Dockerfiles%20%2B%20Config%20(parallel)%0A%20%20%20%20Dockerfile%20(arc-realtime)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ap2a%2C%20after%20p1%2C%202%0A%20%20%20%20Dockerfile.ingress%20(arc-realtime-ingress)%20%20%20%20%20%20%20%20%20%20%20%3Ap2b%2C%20after%20p1%2C%202%0A%20%20%20%20Dockerfile.egress%20(arc-realtime-egress)%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ap2c%2C%20after%20p1%2C%202%0A%20%20%20%20livekit.yaml%20%2B%20ingress.yaml%20%2B%20egress.yaml%20%20%20%20%20%20%20%20%20%20%20%3Ap2d%2C%20after%20p1%2C%202%0A%0A%20%20%20%20section%20Phase%203%20%E2%80%94%20Compose%20%2B%20service.yaml%0A%20%20%20%20docker-compose.yml%20(all%203%20services)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ap3%2C%20after%20p2a%2C%201%0A%20%20%20%20service.yaml%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ap3b%2C%20after%20p2a%2C%201%0A%0A%20%20%20%20section%20Phase%204%20%E2%80%94%20Make%20%2B%20CI%20(parallel)%0A%20%20%20%20realtime.mk%20(all%20targets)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ap4a%2C%20after%20p3%2C%201%0A%20%20%20%20realtime-images.yml%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ap4b%2C%20after%20p3%2C%202%0A%20%20%20%20realtime-release.yml%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ap4c%2C%20after%20p3%2C%202%0A%0A%20%20%20%20section%20Phase%205%20%E2%80%94%20Integration%0A%20%20%20%20Makefile%20include%20%2B%20scripts%20updates%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ap5a%2C%20after%20p4a%2C%201%0A%20%20%20%20make%20realtime-up%20%2B%20make%20realtime-health%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ap5b%2C%20after%20p5a%2C%201%0A%20%20%20%20Docs%20%26%20links%20update%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ap5c%2C%20after%20p5b%2C%201%0A"})]),fallback:i(()=>[...s[3]||(s[3]=[a(" Loading... ",-1)])]),_:1})),s[8]||(s[8]=p('<p><strong>Parallelizable groups:</strong></p><ul><li>Phase 2: All three Dockerfiles and all three config YAML files are fully independent</li><li>Phase 4: <code>realtime-images.yml</code> + <code>realtime-release.yml</code> are independent of each other</li><li>Phase 3: <code>docker-compose.yml</code> + <code>service.yaml</code> can be written concurrently (different files)</li></ul><h2 id="tech-debt" tabindex="-1">Tech Debt <a class="header-anchor" href="#tech-debt" aria-label="Permalink to &quot;Tech Debt&quot;">​</a></h2><table tabindex="0"><thead><tr><th>ID</th><th>Item</th><th>Rationale</th></tr></thead><tbody><tr><td>TD-001</td><td>Vault integration for LiveKit API keys</td><td>Static <code>devkey</code>/<code>devsecret</code> in config files. Production requires dynamic secrets from OpenBao. Deferred to security hardening spec.</td></tr><tr><td>TD-002</td><td>LIVEKIT_NODE_IP for remote clients</td><td>Default <code>127.0.0.1</code> only works locally. Remote/cloud deploy requires setting <code>LIVEKIT_NODE_IP</code> to machine&#39;s public IP. Document in help target.</td></tr><tr><td>TD-003</td><td>TURN/STUN for firewall traversal</td><td><code>node_ip: 127.0.0.1</code> works on LAN. True TURN server for clients behind strict NAT requires a turnserver sidecar (e.g. coturn). Deferred.</td></tr><tr><td>TD-004</td><td>MinIO bucket init for recordings</td><td>Scribe writes to <code>recordings</code> bucket in arc-storage. Bucket must exist. A future init script or MinIO lifecycle policy should pre-create it.</td></tr><tr><td>TD-005</td><td>LiveKit egress requires <code>chrome</code></td><td>LK Egress uses a headless Chromium for composite room recording. The <code>livekit/egress</code> image bundles it but is ~1GB. Future: switch to track-based egress (no Chrome) if size is a concern.</td></tr></tbody></table><h2 id="reviewer-checklist" tabindex="-1">Reviewer Checklist <a class="header-anchor" href="#reviewer-checklist" aria-label="Permalink to &quot;Reviewer Checklist&quot;">​</a></h2><ul><li>[ ] <code>make realtime-up</code> exits 0; all three containers in <code>healthy</code> state</li><li>[ ] <code>make realtime-health</code> exits 0</li><li>[ ] <code>make realtime-down</code> stops all three; no orphaned containers</li><li>[ ] <code>make realtime-up</code> starts <code>arc-cache</code> first if not already running (depends_on)</li><li>[ ] <code>curl -s http://localhost:7880</code> returns response from LiveKit Server</li><li>[ ] <code>curl -s http://localhost:7888</code> returns 200 from Ingress controller</li><li>[ ] <code>curl -s http://localhost:7889</code> returns 200 from Egress controller</li><li>[ ] TCP ports 7880/7881/7882/7888/1935/7889 bind <code>127.0.0.1</code> only — verify with <code>docker compose ps</code></li><li>[ ] UDP <code>50100-50200</code> binds <code>0.0.0.0</code> — verify and confirm documented</li><li>[ ] <code>livekit.yaml</code> mounted read-only at <code>/etc/livekit.yaml</code> in arc-realtime container</li><li>[ ] <code>ingress.yaml</code> and <code>egress.yaml</code> mounted read-only in their respective containers</li><li>[ ] API key consistency: <code>devkey</code>/<code>devsecret</code> used identically in livekit.yaml, ingress.yaml, egress.yaml</li><li>[ ] <code>LIVEKIT_NODE_IP</code> documented in <code>realtime-help</code> output; defaults to <code>127.0.0.1</code></li><li>[ ] Non-root status verified for each image; deviation documented if root required</li><li>[ ] All three Dockerfiles have OCI + <code>arc.service.*</code> labels including <code>arc.service.codename</code></li><li>[ ] <code>services/realtime/service.yaml</code> contains role, codename, image, ports, health, depends_on, sidecars</li><li>[ ] <code>services/profiles.yaml</code> <code>think</code> includes <code>realtime</code>; <code>reason</code> includes <code>realtime</code></li><li>[ ] Root Makefile includes <code>services/realtime/realtime.mk</code></li><li>[ ] <code>publish-all</code> in scripts/scripts.mk includes all three realtime build/publish steps</li><li>[ ] <code>check-dev-prereqs.sh</code> checks ports 7880, 7881, 1935</li><li>[ ] <code>realtime-images.yml</code> path filter <code>services/realtime/**</code>; builds all three images</li><li>[ ] <code>realtime-release.yml</code> tag format <code>realtime/v*</code>; multi-platform amd64 + arm64</li><li>[ ] <code>CLAUDE.md</code> Service Codenames table updated — Daredevil (LiveKit), Sentry (LK Ingress), Scribe (LK Egress)</li><li>[ ] <code>.specify/config.yaml</code> <code>realtime</code> entry updated with correct codename/role</li></ul><h2 id="risks-mitigations" tabindex="-1">Risks &amp; Mitigations <a class="header-anchor" href="#risks-mitigations" aria-label="Permalink to &quot;Risks &amp; Mitigations&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Risk</th><th>Impact</th><th>Mitigation</th></tr></thead><tbody><tr><td>LiveKit images run as root</td><td>M</td><td>Document deviation in Dockerfile + help text; same approach as Nick Fury in 006</td></tr><tr><td><code>wget</code> absent in livekit images</td><td>M</td><td>Fall back to <code>curl -sf http://localhost:PORT</code> in healthcheck — Go images often include curl</td></tr><tr><td>UDP 50100-50200 blocked by macOS firewall</td><td>H</td><td>Document in <code>realtime-help</code>; user must allow UDP range for WebRTC to function</td></tr><tr><td>Port 1935 (RTMP) in use by OBS or similar</td><td>M</td><td>Document in edge cases; user checks <code>make dev-status</code> and stops conflicting process</td></tr><tr><td>Egress <code>recordings</code> bucket missing in MinIO</td><td>M</td><td>Document in TD-004; manual <code>mc mb</code> command in <code>realtime-help</code> until init script exists</td></tr><tr><td>LK Egress Chrome binary makes image ~1GB</td><td>L</td><td>Accepted for dev; noted in TD-005; not a blocker</td></tr><tr><td><code>arc_platform_net</code> not pre-created</td><td>H</td><td><code>realtime-up</code> calls <code>docker network create arc_platform_net 2&gt;/dev/null || true</code> before compose up</td></tr><tr><td><code>LIVEKIT_NODE_IP</code> env expansion in livekit.yaml</td><td>M</td><td>LiveKit supports env var expansion in YAML config — verify <code>${LIVEKIT_NODE_IP:-127.0.0.1}</code> syntax is supported; fallback to compose <code>environment:</code> injection if not</td></tr></tbody></table><p>&lt;NolebaseGitContributors /&gt;</p><p>&lt;NolebaseGitChangelog /&gt;</p>',10))])}const v=k(c,[["render",E]]);export{A as __pageData,v as default};
