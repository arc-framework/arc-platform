import{_ as o,C as d,o as t,c as k,an as h,b as l,w as a,a as i,E as r,ao as p,j as e}from"./chunks/framework.CTqRDTHW.js";const C=JSON.parse('{"title":"Implementation Plan: Platform Control Plane Services Setup","description":"","frontmatter":{},"headers":[],"relativePath":"006-platform-control/plan.md","filePath":"006-platform-control/plan.md","lastUpdated":1772310733000}'),c={name:"006-platform-control/plan.md"};function E(y,s,g,u,m,F){const n=d("Mermaid");return t(),k("div",null,[s[4]||(s[4]=h('<h1 id="implementation-plan-platform-control-plane-services-setup" tabindex="-1">Implementation Plan: Platform Control Plane Services Setup <a class="header-anchor" href="#implementation-plan-platform-control-plane-services-setup" aria-label="Permalink to &quot;Implementation Plan: Platform Control Plane Services Setup&quot;">​</a></h1><blockquote><p><strong>Spec</strong>: 006-platform-control <strong>Date</strong>: 2026-02-28</p></blockquote><h2 id="summary" tabindex="-1">Summary <a class="header-anchor" href="#summary" aria-label="Permalink to &quot;Summary&quot;">​</a></h2><p>Add three control plane services — Traefik v3 (Heimdall), OpenBao (Nick Fury), Unleash (Mystique) — each following the same structural pattern as 003-messaging-setup and 005-data-layer: thin Dockerfile label wrapper, <code>service.yaml</code>, <code>docker-compose.yml</code>, dedicated <code>.mk</code> include, CI/release workflows. All three join <code>arc_platform_net</code>. Non-root handling requires per-service decisions: Heimdall uses internal port remapping (non-privileged :8080 proxy); Nick Fury documents root deviation (dev mode is inherently insecure by design); Mystique attempts <code>user: &quot;1000:1000&quot;</code> at runtime. Profiles updated so <code>think</code> includes heimdall; <code>reason</code> adds nick-fury + mystique.</p><h2 id="target-modules" tabindex="-1">Target Modules <a class="header-anchor" href="#target-modules" aria-label="Permalink to &quot;Target Modules&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Module</th><th>Language</th><th>Changes</th></tr></thead><tbody><tr><td><code>services/gateway/</code></td><td>Config/Dockerfile</td><td>New — Traefik v3 (Heimdall)</td></tr><tr><td><code>services/secrets/</code></td><td>Config/Dockerfile</td><td>New — OpenBao (Nick Fury)</td></tr><tr><td><code>services/flags/</code></td><td>Config/Dockerfile</td><td>New — Unleash (Mystique)</td></tr><tr><td><code>services/profiles.yaml</code></td><td>YAML</td><td>Add heimdall to <code>think</code>; nick-fury + mystique to <code>reason</code></td></tr><tr><td><code>.github/workflows/</code></td><td>YAML</td><td>New — control-images.yml + control-release.yml</td></tr><tr><td><code>Makefile</code></td><td>Make</td><td>Include heimdall.mk, nick-fury.mk, mystique.mk, control.mk + publish-all</td></tr><tr><td><code>services/control.mk</code></td><td>Make</td><td>New — aggregate up/down/health/logs</td></tr></tbody></table><h2 id="technical-context" tabindex="-1">Technical Context <a class="header-anchor" href="#technical-context" aria-label="Permalink to &quot;Technical Context&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Aspect</th><th>Value</th></tr></thead><tbody><tr><td>Language</td><td>Config-only (YAML, Dockerfile, Makefile) — no application code</td></tr><tr><td>Base Images</td><td><code>traefik:v3</code>, <code>openbao/openbao</code>, <code>unleashorg/unleash-server</code></td></tr><tr><td>Testing</td><td><code>traefik healthcheck --ping</code>, <code>/v1/sys/health</code>, <code>curl /health</code></td></tr><tr><td>Network</td><td><code>arc_platform_net</code> (external bridge, pre-existing)</td></tr><tr><td>Volumes</td><td>None for Heimdall/Nick Fury (stateless in dev); none for Mystique (DB-backed)</td></tr><tr><td>CI Pattern</td><td>Mirror <code>data-images.yml</code> — amd64-only CI, dorny/paths-filter per service</td></tr><tr><td>Root handling</td><td>Heimdall: port remap to uid 1000; Nick Fury: root documented; Mystique: try uid 1000</td></tr></tbody></table><h2 id="architecture" tabindex="-1">Architecture <a class="header-anchor" href="#architecture" aria-label="Permalink to &quot;Architecture&quot;">​</a></h2><h3 id="service-topology" tabindex="-1">Service topology <a class="header-anchor" href="#service-topology" aria-label="Permalink to &quot;Service topology&quot;">​</a></h3>',10)),(t(),l(p,null,{default:a(()=>[r(n,{id:"mermaid-190",class:"mermaid",graph:"graph%20TB%0A%20%20%20%20subgraph%20Host%0A%20%20%20%20%20%20%20%20subgraph%20arc_platform_net%0A%20%20%20%20%20%20%20%20%20%20%20%20heimdall%5B%22arc-gateway%5Cntraefik%3Av3%5Cn%3A8080%20proxy%20(host%E2%86%92%3A80)%5Cn%3A8090%20dashboard%22%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20fury%5B%22arc-vault%5Cnopenbao%2Fopenbao%5Cn%3A8200%20API%20%2B%20UI%22%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20mystique%5B%22arc-flags%5Cnunleash-server%5Cn%3A4242%20UI%20%2B%20REST%22%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20oracle%5B%22arc-sql-db%5Cnpostgres%3A17%5Cn%3A5432%22%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20sonic%5B%22arc-cache%5Cnredis%5Cn%3A6379%22%5D%0A%20%20%20%20%20%20%20%20end%0A%20%20%20%20%20%20%20%20dockersock%5B%22%2Fvar%2Frun%2Fdocker.sock%20(ro)%22%5D%0A%20%20%20%20end%0A%0A%20%20%20%20dockersock%20-.-%3E%7Cproviders.docker%7C%20heimdall%0A%20%20%20%20mystique%20--%3E%7CDATABASE_URL%7C%20oracle%0A%20%20%20%20mystique%20--%3E%7CREDIS_HOST%7C%20sonic%0A%20%20%20%20apps%5B%22Clients%22%5D%20--%3E%7CHTTP%20%3A80%7C%20heimdall%0A%20%20%20%20apps%20--%3E%7Csecrets%20%3A8200%7C%20fury%0A%20%20%20%20apps%20--%3E%7Cflags%20%3A4242%7C%20mystique%0A"})]),fallback:a(()=>[...s[0]||(s[0]=[i(" Loading... ",-1)])]),_:1})),s[5]||(s[5]=e("h3",{id:"heimdall-port-remapping-non-root-strategy",tabindex:"-1"},[i("Heimdall port remapping (non-root strategy) "),e("a",{class:"header-anchor",href:"#heimdall-port-remapping-non-root-strategy","aria-label":'Permalink to "Heimdall port remapping (non-root strategy)"'},"​")],-1)),(t(),l(p,null,{default:a(()=>[r(n,{id:"mermaid-194",class:"mermaid",graph:"graph%20LR%0A%20%20%20%20host80%5B%22Host%20%3A80%22%5D%20--%3E%7C127.0.0.1%3A80%3A8080%7C%20proxy%5B%22Container%20%3A8080%5CnTraefik%20entrypoint.web%22%5D%0A%20%20%20%20host8090%5B%22Host%20%3A8090%22%5D%20--%3E%7C127.0.0.1%3A8090%3A8090%7C%20dash%5B%22Container%20%3A8090%5CnTraefik%20API%2Fdashboard%5Cn--api.insecure%3Dtrue%22%5D%0A%20%20%20%20docker%5B%22Docker%20socket%20(ro)%22%5D%20--%3E%7Clabel%20discovery%7C%20proxy%0A"})]),fallback:a(()=>[...s[1]||(s[1]=[i(" Loading... ",-1)])]),_:1})),s[6]||(s[6]=e("p",null,[i("Internal container ports are non-privileged ("),e("code",null,"≥1024"),i("), so Traefik runs as "),e("code",null,"uid 1000"),i(" without any capabilities.")],-1)),s[7]||(s[7]=e("h3",{id:"file-pattern-identical-across-all-three",tabindex:"-1"},[i("File pattern (identical across all three) "),e("a",{class:"header-anchor",href:"#file-pattern-identical-across-all-three","aria-label":'Permalink to "File pattern (identical across all three)"'},"​")],-1)),(t(),l(p,null,{default:a(()=>[r(n,{id:"mermaid-201",class:"mermaid",graph:"graph%20LR%0A%20%20%20%20A%5B%22Dockerfile%5CnFROM%20upstream%5CnOCI%20%2B%20arc%20labels%5Cnnon-root%20where%20possible%22%5D%20--%3E%20B%5B%22docker-compose.yml%5Cn127.0.0.1%20ports%5Cnarc_platform_net%20external%5Cnenv%20%2F%20command%20flags%22%5D%0A%20%20%20%20B%20--%3E%20C%5B%22service.yaml%5Cnname%2C%20codename%2C%20image%5Cnports%2C%20health%2C%20depends_on%22%5D%0A%20%20%20%20C%20--%3E%20D%5B%22%7Bservice%7D.mk%5Cnup%20%C2%B7%20down%20%C2%B7%20health%20%C2%B7%20logs%5Cnbuild%20%C2%B7%20push%20%C2%B7%20publish%20%C2%B7%20tag%5Cnclean%20%C2%B7%20nuke%20%C2%B7%20help%22%5D%0A"})]),fallback:a(()=>[...s[2]||(s[2]=[i(" Loading... ",-1)])]),_:1})),s[8]||(s[8]=h(`<h2 id="key-implementation-decisions" tabindex="-1">Key Implementation Decisions <a class="header-anchor" href="#key-implementation-decisions" aria-label="Permalink to &quot;Key Implementation Decisions&quot;">​</a></h2><h3 id="_1-heimdall-—-non-root-via-internal-port-remapping" tabindex="-1">1. Heimdall — Non-root via internal port remapping <a class="header-anchor" href="#_1-heimdall-—-non-root-via-internal-port-remapping" aria-label="Permalink to &quot;1. Heimdall — Non-root via internal port remapping&quot;">​</a></h3><p>Traefik in default config binds to privileged port 80 (requires root). Solution: configure internal entrypoints on non-privileged ports; remap at the Docker host layer.</p><div class="language-dockerfile vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># services/gateway/Dockerfile</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> traefik:v3</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LABEL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> org.opencontainers.image.title=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ARC Heimdall — API Gateway&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LABEL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> org.opencontainers.image.description=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Traefik v3 ingress gateway for the A.R.C. Platform&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LABEL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> org.opencontainers.image.source=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://github.com/arc-framework/arc-platform&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LABEL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> arc.service.name=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;arc-gateway&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LABEL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> arc.service.codename=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;heimdall&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LABEL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> arc.service.tech=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;traefik&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># traefik:v3 runs as root by default. We configure internal ports ≥1024</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># so the process runs as uid 1000 without CAP_NET_BIND_SERVICE.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">USER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 1000</span></span></code></pre></div><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># services/gateway/docker-compose.yml</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">arc-gateway</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  command</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">--api.insecure=true</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                          # dashboard on internal :8090</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">--api.dashboard=true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">--ping=true</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                                  # /ping healthcheck endpoint</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">--providers.docker=true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">--providers.docker.network=arc_platform_net</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">--providers.docker.exposedbydefault=false</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # opt-in only via labels</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">--entrypoints.web.address=:8080</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">              # non-privileged proxy port</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">--entrypoints.dashboard.address=:8090</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # dashboard port</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;127.0.0.1:80:8080&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     # host:80 → container proxy (non-privileged inside)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;127.0.0.1:8090:8090&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   # dashboard</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/var/run/docker.sock:/var/run/docker.sock:ro</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  user</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1000:1000&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  healthcheck</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;CMD&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;traefik&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;healthcheck&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;--ping&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    interval</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">5s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    timeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">3s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    retries</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    start_period</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">5s</span></span></code></pre></div><p><strong>Key</strong>: <code>--providers.docker.exposedbydefault=false</code> means services must opt-in via <code>traefik.enable=true</code> label. Prevents unintentional routing.</p><h3 id="_2-nick-fury-—-root-deviation-documented-dev-mode-by-design" tabindex="-1">2. Nick Fury — Root deviation (documented, dev mode by design) <a class="header-anchor" href="#_2-nick-fury-—-root-deviation-documented-dev-mode-by-design" aria-label="Permalink to &quot;2. Nick Fury — Root deviation (documented, dev mode by design)&quot;">​</a></h3><p>OpenBao in dev mode (<code>-dev</code> flag) is intentionally insecure: in-memory storage, known root token, auto-unsealed. Running as root is consistent with the dev-only posture of this service. Document in Dockerfile and help text.</p><div class="language-dockerfile vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># services/secrets/Dockerfile</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> openbao/openbao</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LABEL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> arc.service.name=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;arc-vault&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LABEL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> arc.service.codename=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;nick-fury&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LABEL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> arc.service.tech=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;openbao&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># openbao/openbao runs as root by default.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Nick Fury uses -dev mode (in-memory, auto-unsealed, known root token).</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># This is a DEVELOPMENT-ONLY service. Root is acceptable for dev-mode OpenBao.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># For production: use Raft-backed storage with TLS + non-root user.</span></span></code></pre></div><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># services/secrets/docker-compose.yml</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">arc-vault</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  command</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">server -dev</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  environment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    VAULT_DEV_ROOT_TOKEN_ID</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">arc-dev-token</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    VAULT_DEV_LISTEN_ADDRESS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">0.0.0.0:8200</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;127.0.0.1:8200:8200&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  healthcheck</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;CMD-SHELL&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;wget -qO- http://localhost:8200/v1/sys/health || exit 1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    interval</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">5s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    timeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">3s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    retries</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    start_period</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">5s</span></span></code></pre></div><p>If <code>wget</code> is absent in the openbao image, fall back to bash <code>/dev/tcp</code> (same pattern as Cerebro).</p><h3 id="_3-mystique-—-non-root-attempt-document-if-fails" tabindex="-1">3. Mystique — Non-root attempt, document if fails <a class="header-anchor" href="#_3-mystique-—-non-root-attempt-document-if-fails" aria-label="Permalink to &quot;3. Mystique — Non-root attempt, document if fails&quot;">​</a></h3><p>Unleash is a Node.js app. <code>user: &quot;1000:1000&quot;</code> in compose is the first attempt. If Unleash writes to privileged paths at startup, document the root deviation in compose comments (like Pulsar in 003).</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># services/flags/docker-compose.yml</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">arc-flags</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  user</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1000:1000&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   # attempt non-root; remove + add comment if Unleash refuses to start</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  environment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    DATABASE_URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">postgresql://arc:arc@arc-sql-db:5432/unleash</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    REDIS_HOST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">arc-cache</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    REDIS_PORT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">6379</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;127.0.0.1:4242:4242&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  healthcheck</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;CMD-SHELL&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;wget -qO- http://localhost:4242/health || exit 1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    interval</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">10s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    timeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">5s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    retries</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    start_period</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">30s</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   # Unleash runs DB migrations on first boot — needs longer start_period</span></span></code></pre></div><p><strong>Key</strong>: <code>start_period: 30s</code> — Unleash auto-runs DB migrations on first startup against Oracle; this takes 10-20s.</p><h3 id="_4-service-yaml-pattern-mystique-depends-on" tabindex="-1">4. service.yaml pattern (Mystique depends_on) <a class="header-anchor" href="#_4-service-yaml-pattern-mystique-depends-on" aria-label="Permalink to &quot;4. service.yaml pattern (Mystique depends_on)&quot;">​</a></h3><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># services/flags/service.yaml</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">arc-flags</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">codename</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">mystique</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ghcr.io/arc-framework/arc-flags:latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">tech</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">unleash</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">upstream</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">unleashorg/unleash-server</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - { </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4242</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">protocol</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">description</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Unleash UI + REST API&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">health</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  endpoint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">http://localhost:4242/health</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  interval</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">10s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">depends_on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">oracle</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   # Postgres — feature flag state storage</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">sonic</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Redis — session cache</span></span></code></pre></div><h3 id="_5-control-mk-aggregate-mirrors-data-mk" tabindex="-1">5. control.mk aggregate (mirrors data.mk) <a class="header-anchor" href="#_5-control-mk-aggregate-mirrors-data-mk" aria-label="Permalink to &quot;5. control.mk aggregate (mirrors data.mk)&quot;">​</a></h3><div class="language-makefile vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">makefile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## control-up: Start all control plane services (Heimdall + Nick Fury + Mystique)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">control-up</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @docker network create arc_platform_net 2&gt;/dev/null || true</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    $(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MAKE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> heimdall-up --no-print-directory</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    $(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MAKE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nick-fury-up --no-print-directory</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    $(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MAKE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mystique-up --no-print-directory</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## control-down: Stop all control plane services</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">control-down</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    $(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MAKE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mystique-down --no-print-directory</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    $(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MAKE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nick-fury-down --no-print-directory</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    $(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MAKE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> heimdall-down --no-print-directory</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## control-health: Check health of all control plane services</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">control-health</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">$(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MAKE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> heimdall-health --no-print-directory &amp;&amp; \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     $(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MAKE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nick-fury-health --no-print-directory &amp;&amp; \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     $(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MAKE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mystique-health --no-print-directory</span></span></code></pre></div><p>Note: <code>control-up</code> starts in dependency order; <code>control-down</code> reverses it (Mystique first, then infra).</p><h3 id="_6-ci-cd-—-mirrors-data-images-yml-exactly" tabindex="-1">6. CI/CD — mirrors data-images.yml exactly <a class="header-anchor" href="#_6-ci-cd-—-mirrors-data-images-yml-exactly" aria-label="Permalink to &quot;6. CI/CD — mirrors data-images.yml exactly&quot;">​</a></h3><p><code>control-images.yml</code> path filters:</p><ul><li><code>services/gateway/**</code> → build-heimdall</li><li><code>services/secrets/**</code> → build-nick-fury</li><li><code>services/flags/**</code> → build-mystique</li></ul><p><code>control-release.yml</code> tag format: <code>control/vX.Y.Z</code> → Docker tag <code>control-vX.Y.Z</code></p><h3 id="_7-profiles-yaml-update" tabindex="-1">7. profiles.yaml update <a class="header-anchor" href="#_7-profiles-yaml-update" aria-label="Permalink to &quot;7. profiles.yaml update&quot;">​</a></h3><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">think</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">flash</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">sonic</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">strange</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">friday-collector</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">cortex</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">oracle</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">cerebro</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">heimdall</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       # ← ADD: gateway is foundational for any agent platform</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">reason</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">cortex</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">flash</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">strange</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">sonic</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">otel</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">tardis</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">nick-fury</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # ← ADD: secrets management</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">mystique</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       # ← ADD: feature flags</span></span></code></pre></div><h2 id="constitution-check" tabindex="-1">Constitution Check <a class="header-anchor" href="#constitution-check" aria-label="Permalink to &quot;Constitution Check&quot;">​</a></h2><table tabindex="0"><thead><tr><th>#</th><th>Principle</th><th>Status</th><th>Evidence</th></tr></thead><tbody><tr><td>I</td><td>Zero-Dep CLI</td><td>N/A</td><td>No CLI changes</td></tr><tr><td>II</td><td>Platform-in-a-Box</td><td>PASS</td><td><code>make control-up</code> boots all three; heimdall joins <code>think</code> profile</td></tr><tr><td>III</td><td>Modular Services</td><td>PASS</td><td>Each self-contained in own directory under <code>services/</code>; own service.yaml</td></tr><tr><td>IV</td><td>Two-Brain</td><td>PASS</td><td>Config-only upstream images — no language concern</td></tr><tr><td>V</td><td>Polyglot Standards</td><td>PASS</td><td>Same Dockerfile/compose/healthcheck structure as 003/005</td></tr><tr><td>VI</td><td>Local-First</td><td>N/A</td><td>CLI only</td></tr><tr><td>VII</td><td>Observability</td><td>PASS</td><td>Traefik dashboard + /ping; OpenBao /v1/sys/health; Unleash /health</td></tr><tr><td>VIII</td><td>Security</td><td>PASS†</td><td>Heimdall uid 1000; Mystique uid 1000 (attempt); Nick Fury root documented (dev-mode-only)</td></tr><tr><td>IX</td><td>Declarative</td><td>N/A</td><td>CLI only</td></tr><tr><td>X</td><td>Stateful Ops</td><td>N/A</td><td>CLI only</td></tr><tr><td>XI</td><td>Resilience</td><td>PASS</td><td>Health checks with appropriate start_periods; Mystique depends_on oracle + sonic</td></tr><tr><td>XII</td><td>Interactive</td><td>N/A</td><td>CLI only</td></tr></tbody></table><p>†<strong>Security note</strong>: Nick Fury root deviation is intentional — OpenBao <code>-dev</code> mode is by-design insecure (ephemeral, known token). Documented in Dockerfile and <code>nick-fury-help</code>. Not a constitution violation given the explicit dev-only scope.</p><h2 id="project-structure" tabindex="-1">Project Structure <a class="header-anchor" href="#project-structure" aria-label="Permalink to &quot;Project Structure&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>arc-platform/</span></span>
<span class="line"><span>├── services/</span></span>
<span class="line"><span>│   ├── gateway/                              ← NEW (Heimdall / Traefik v3)</span></span>
<span class="line"><span>│   │   ├── Dockerfile                        # FROM traefik:v3; OCI + arc labels; USER 1000</span></span>
<span class="line"><span>│   │   ├── service.yaml                      # name, codename, ports 80+8090, health /ping</span></span>
<span class="line"><span>│   │   ├── docker-compose.yml                # port remap 80:8080; Docker socket ro; no volume</span></span>
<span class="line"><span>│   │   └── heimdall.mk                       # heimdall-up/down/health/logs/build/push/publish/...</span></span>
<span class="line"><span>│   ├── secrets/                              ← NEW (Nick Fury / OpenBao)</span></span>
<span class="line"><span>│   │   ├── Dockerfile                        # FROM openbao/openbao; OCI + arc labels; root documented</span></span>
<span class="line"><span>│   │   ├── service.yaml                      # name, codename, port 8200, health /v1/sys/health</span></span>
<span class="line"><span>│   │   ├── docker-compose.yml                # -dev mode; VAULT_DEV_ROOT_TOKEN_ID; no volume</span></span>
<span class="line"><span>│   │   └── nick-fury.mk                      # nick-fury-up/down/health/logs/build/push/publish/...</span></span>
<span class="line"><span>│   ├── flags/                                ← NEW (Mystique / Unleash)</span></span>
<span class="line"><span>│   │   ├── Dockerfile                        # FROM unleashorg/unleash-server; OCI + arc labels</span></span>
<span class="line"><span>│   │   ├── service.yaml                      # name, codename, port 4242, depends_on: oracle, sonic</span></span>
<span class="line"><span>│   │   ├── docker-compose.yml                # DATABASE_URL + REDIS_*; user 1000; start_period 30s</span></span>
<span class="line"><span>│   │   └── mystique.mk                       # mystique-up/down/health/logs/build/push/publish/...</span></span>
<span class="line"><span>│   ├── profiles.yaml                         # MODIFY — think += heimdall; reason += nick-fury, mystique</span></span>
<span class="line"><span>│   └── control.mk                            ← NEW (aggregate)</span></span>
<span class="line"><span>├── .github/workflows/</span></span>
<span class="line"><span>│   ├── control-images.yml                    ← NEW</span></span>
<span class="line"><span>│   └── control-release.yml                   ← NEW</span></span>
<span class="line"><span>└── Makefile                                  # MODIFY — include *.mk + publish-all</span></span></code></pre></div><h2 id="parallel-execution-strategy" tabindex="-1">Parallel Execution Strategy <a class="header-anchor" href="#parallel-execution-strategy" aria-label="Permalink to &quot;Parallel Execution Strategy&quot;">​</a></h2>`,32)),(t(),l(p,null,{default:a(()=>[r(n,{id:"mermaid-479",class:"mermaid",graph:"gantt%0A%20%20%20%20title%20006-platform-control%20Implementation%20Phases%0A%20%20%20%20dateFormat%20X%0A%20%20%20%20axisFormat%20%25s%0A%0A%20%20%20%20section%20Phase%201%20%E2%80%94%20Foundation%0A%20%20%20%20Update%20profiles.yaml%20(heimdall%E2%86%92think%2C%20fury%2Bmystique%E2%86%92reason)%20%20%3Ap1%2C%200%2C%201%0A%0A%20%20%20%20section%20Phase%202%20%E2%80%94%20Services%20(fully%20parallel)%0A%20%20%20%20gateway%2F%3A%20Dockerfile%20%2B%20service.yaml%20%2B%20compose%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ap2a%2C%20after%20p1%2C%202%0A%20%20%20%20secrets%2F%3A%20Dockerfile%20%2B%20service.yaml%20%2B%20compose%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ap2b%2C%20after%20p1%2C%202%0A%20%20%20%20flags%2F%3A%20Dockerfile%20%2B%20service.yaml%20%2B%20compose%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ap2c%2C%20after%20p1%2C%202%0A%0A%20%20%20%20section%20Phase%203%20%E2%80%94%20Make%20targets%20(parallel%20per%20service)%0A%20%20%20%20heimdall.mk%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ap3a%2C%20after%20p2a%2C%201%0A%20%20%20%20nick-fury.mk%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ap3b%2C%20after%20p2b%2C%201%0A%20%20%20%20mystique.mk%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ap3c%2C%20after%20p2c%2C%201%0A%20%20%20%20control.mk%20aggregate%20%2B%20Makefile%20includes%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ap3d%2C%20after%20p2a%2C%201%0A%0A%20%20%20%20section%20Phase%204%20%E2%80%94%20CI%2FCD%20(parallel)%0A%20%20%20%20control-images.yml%20workflow%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ap4a%2C%20after%20p3d%2C%202%0A%20%20%20%20control-release.yml%20workflow%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ap4b%2C%20after%20p3d%2C%202%0A%0A%20%20%20%20section%20Phase%205%20%E2%80%94%20Integration%0A%20%20%20%20make%20control-up%20%2B%20make%20control-health%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ap5%2C%20after%20p4b%2C%201%0A%20%20%20%20Docs%20%26%20links%20update%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ap5b%2C%20after%20p5%2C%201%0A"})]),fallback:a(()=>[...s[3]||(s[3]=[i(" Loading... ",-1)])]),_:1})),s[9]||(s[9]=h('<p><strong>Parallelizable groups:</strong></p><ul><li>Phase 2: All three service directories are fully independent</li><li>Phase 3: heimdall.mk + nick-fury.mk + mystique.mk — independent after Phase 2 deps</li><li>Phase 4: control-images.yml + control-release.yml — independent of each other</li></ul><h2 id="tech-debt" tabindex="-1">Tech Debt <a class="header-anchor" href="#tech-debt" aria-label="Permalink to &quot;Tech Debt&quot;">​</a></h2><table tabindex="0"><thead><tr><th>ID</th><th>Item</th><th>Rationale</th></tr></thead><tbody><tr><td>TD-001</td><td>Nick Fury production mode</td><td>OpenBao <code>-dev</code> mode is stateless and insecure. Production requires Raft-backed storage, TLS, and non-root user. Deferred to a future security hardening spec.</td></tr><tr><td>TD-002</td><td>Heimdall TLS termination</td><td>No HTTPS in dev. Production needs TLS config (cert resolvers, ACME). Deferred.</td></tr><tr><td>TD-003</td><td>Mystique admin credentials</td><td>Unleash auto-creates admin user on first boot; credentials are printed in logs. A future init task should configure an admin API token via env to avoid manual setup.</td></tr><tr><td>TD-004</td><td>Traefik metrics scraping</td><td>Traefik exposes Prometheus metrics at <code>:8090/metrics</code>. When a dashboard requirement exists, add scrape job to OTEL collector (see 003 pattern).</td></tr></tbody></table><h2 id="reviewer-checklist" tabindex="-1">Reviewer Checklist <a class="header-anchor" href="#reviewer-checklist" aria-label="Permalink to &quot;Reviewer Checklist&quot;">​</a></h2><ul><li>[ ] <code>make control-up</code> exits 0; all three containers in <code>healthy</code> state</li><li>[ ] <code>make control-health</code> exits 0</li><li>[ ] <code>make control-down</code> stops all three; no orphaned containers</li><li>[ ] <code>make heimdall-up &amp;&amp; make heimdall-health</code> works independently</li><li>[ ] <code>make nick-fury-up &amp;&amp; make nick-fury-health</code> works independently</li><li>[ ] <code>make mystique-up &amp;&amp; make mystique-health</code> works independently (requires oracle + sonic running)</li><li>[ ] <code>curl http://localhost:8090/ping</code> returns <code>OK</code> (Traefik ping endpoint)</li><li>[ ] Traefik dashboard accessible at <code>http://localhost:8090/dashboard/</code></li><li>[ ] <code>curl -H &quot;X-Vault-Token: arc-dev-token&quot; http://localhost:8200/v1/sys/health</code> returns HTTP 200</li><li>[ ] <code>curl http://localhost:4242/health</code> returns HTTP 200</li><li>[ ] <code>docker inspect arc-gateway | jq &#39;.[0].Config.User&#39;</code> confirms <code>&quot;1000:1000&quot;</code> or <code>&quot;1000&quot;</code></li><li>[ ] <code>docker inspect arc-flags | jq &#39;.[0].Config.User&#39;</code> confirms non-root or deviation documented</li><li>[ ] Nick Fury root deviation documented in Dockerfile comment + <code>nick-fury-help</code> output</li><li>[ ] All ports bind <code>127.0.0.1</code> only — verify with <code>docker compose ps</code></li><li>[ ] No persistent volumes for Heimdall or Nick Fury (stateless dev services)</li><li>[ ] <code>services/profiles.yaml</code> <code>think</code> includes <code>heimdall</code>; <code>reason</code> includes <code>nick-fury</code> + <code>mystique</code></li><li>[ ] Makefile includes <code>heimdall.mk</code>, <code>nick-fury.mk</code>, <code>mystique.mk</code>, <code>control.mk</code></li><li>[ ] <code>publish-all</code> includes <code>heimdall-build heimdall-publish</code>, <code>nick-fury-build nick-fury-publish</code>, <code>mystique-build mystique-publish</code></li><li>[ ] <code>control-images.yml</code> path filters cover all three service dirs</li><li>[ ] <code>control-release.yml</code> tag format <code>control/v*</code>; multi-platform amd64 + arm64</li><li>[ ] All Dockerfiles have OCI + <code>arc.service.*</code> labels</li><li>[ ] <code>CLAUDE.md</code> Service Codenames table updated (Nick Fury: Infisical → OpenBao)</li><li>[ ] <code>.specify/config.yaml</code> <code>secrets</code> entry tech updated from <code>infisical</code> to <code>openbao</code></li></ul><h2 id="risks-mitigations" tabindex="-1">Risks &amp; Mitigations <a class="header-anchor" href="#risks-mitigations" aria-label="Permalink to &quot;Risks &amp; Mitigations&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Risk</th><th>Impact</th><th>Mitigation</th></tr></thead><tbody><tr><td>Traefik uid 1000 fails (needs root for some internal operation)</td><td>M</td><td>Fall back to root + document deviation like Pulsar in 003</td></tr><tr><td>Mystique uid 1000 fails (writes to privileged path at startup)</td><td>M</td><td>Remove <code>user:</code> from compose; add comment documenting root deviation</td></tr><tr><td>Mystique startup fails because Oracle isn&#39;t ready</td><td>H</td><td><code>start_period: 30s</code> + Unleash&#39;s built-in retry; <code>control-up</code> ensures oracle starts first via ordering</td></tr><tr><td><code>wget</code> absent in openbao image</td><td>M</td><td>Fall back to bash <code>/dev/tcp</code> pattern (same as arc-vector-db)</td></tr><tr><td>Port 80 already bound on dev machine (other HTTP server)</td><td>M</td><td>Document in <code>heimdall-help</code>; user can change host port via compose override</td></tr><tr><td>Mystique DB migration creates tables in <code>arc</code> DB instead of separate DB</td><td>L</td><td>Verify <code>DATABASE_URL</code> points to <code>/unleash</code> DB path; Oracle Dockerfile may need <code>CREATE DATABASE unleash</code> init SQL</td></tr><tr><td><code>arc_platform_net</code> not created before <code>make control-up</code></td><td>H</td><td><code>control-up</code> calls `docker network create arc_platform_net 2&gt;/dev/null</td></tr></tbody></table>',8))])}const f=o(c,[["render",E]]);export{C as __pageData,f as default};
