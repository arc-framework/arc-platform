import{_ as h,C as o,o as e,c as k,a2 as d,b as n,w as a,a as i,E as l,a3 as r,j as p}from"./chunks/framework.C-cuuT8Z.js";const A=JSON.parse('{"title":"Implementation Plan: Data Layer Services Setup","description":"","frontmatter":{},"headers":[],"relativePath":"005-data-layer/plan.md","filePath":"005-data-layer/plan.md","lastUpdated":1772310733000}'),c={name:"005-data-layer/plan.md"};function E(g,s,m,y,u,F){const t=o("Mermaid");return e(),k("div",null,[s[4]||(s[4]=d('<h1 id="implementation-plan-data-layer-services-setup" tabindex="-1">Implementation Plan: Data Layer Services Setup <a class="header-anchor" href="#implementation-plan-data-layer-services-setup" aria-label="Permalink to &quot;Implementation Plan: Data Layer Services Setup&quot;">​</a></h1><blockquote><p><strong>Spec</strong>: 005-data-layer <strong>Date</strong>: 2026-02-28</p></blockquote><h2 id="summary" tabindex="-1">Summary <a class="header-anchor" href="#summary" aria-label="Permalink to &quot;Summary&quot;">​</a></h2><p>Add three infrastructure services — Postgres 17 (Oracle), Qdrant (Cerebro), MinIO (Tardis) — each following the exact same structural pattern as 003-messaging-setup: thin Dockerfile label wrapper, <code>service.yaml</code>, <code>docker-compose.yml</code>, dedicated <code>.mk</code> include, and CI/release workflows. All three join <code>arc_platform_net</code> (existing external bridge). No OTEL collector changes in this spec — Prometheus scraping for Qdrant and MinIO is deferred as tech debt. Profiles updated so <code>think</code> includes oracle + cerebro; <code>reason</code> adds tardis.</p><h2 id="target-modules" tabindex="-1">Target Modules <a class="header-anchor" href="#target-modules" aria-label="Permalink to &quot;Target Modules&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Module</th><th>Language</th><th>Changes</th></tr></thead><tbody><tr><td><code>services/persistence/</code></td><td>Config/Dockerfile</td><td>New — Postgres 17 (Oracle)</td></tr><tr><td><code>services/vector/</code></td><td>Config/Dockerfile</td><td>New — Qdrant (Cerebro)</td></tr><tr><td><code>services/storage/</code></td><td>Config/Dockerfile</td><td>New — MinIO (Tardis)</td></tr><tr><td><code>services/profiles.yaml</code></td><td>YAML</td><td>Add oracle + cerebro to <code>think</code>; tardis to <code>reason</code></td></tr><tr><td><code>.github/workflows/</code></td><td>YAML</td><td>New — data-images.yml + data-release.yml</td></tr><tr><td><code>Makefile</code></td><td>Make</td><td>Include oracle.mk, cerebro.mk, tardis.mk, data.mk</td></tr><tr><td><code>services/data.mk</code></td><td>Make</td><td>New — aggregate up/down/health/logs for all three</td></tr></tbody></table><h2 id="technical-context" tabindex="-1">Technical Context <a class="header-anchor" href="#technical-context" aria-label="Permalink to &quot;Technical Context&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Aspect</th><th>Value</th></tr></thead><tbody><tr><td>Language</td><td>Config-only (YAML, Dockerfile) — no application code</td></tr><tr><td>Base Images</td><td><code>postgres:17-alpine</code>, <code>qdrant/qdrant</code>, <code>minio/minio</code></td></tr><tr><td>Testing</td><td><code>docker compose ps</code>, <code>pg_isready</code>, <code>curl /readyz</code>, <code>curl /minio/health/live</code></td></tr><tr><td>Network</td><td><code>arc_platform_net</code> (external bridge, pre-existing) — no new networks</td></tr><tr><td>Volumes</td><td>Named volumes: <code>arc-sql-db-data</code>, <code>arc-vector-db-data</code>, <code>arc-storage-data</code></td></tr><tr><td>CI Pattern</td><td>Mirror <code>messaging-images.yml</code> — amd64-only CI, dorny/paths-filter per service</td></tr><tr><td>Health Checks</td><td>Oracle: <code>pg_isready</code>; Cerebro: HTTP <code>/readyz</code>; Tardis: HTTP <code>/minio/health/live</code></td></tr></tbody></table><h2 id="architecture" tabindex="-1">Architecture <a class="header-anchor" href="#architecture" aria-label="Permalink to &quot;Architecture&quot;">​</a></h2><h3 id="service-file-pattern-same-for-all-three" tabindex="-1">Service file pattern (same for all three) <a class="header-anchor" href="#service-file-pattern-same-for-all-three" aria-label="Permalink to &quot;Service file pattern (same for all three)&quot;">​</a></h3>',10)),(e(),n(r,null,{default:a(()=>[l(t,{id:"mermaid-190",class:"mermaid",graph:"graph%20LR%0A%20%20%20%20A%5BDockerfile%5Cnpins%20upstream%20image%5Cnadds%20OCI%20%2B%20arc%20labels%5Cnnon-root%20user%5D%20--%3E%20B%5Bdocker-compose.yml%5Cnports%20127.0.0.1%20only%5Cnnamed%20volumes%5Cnarc_platform_net%20external%5D%0A%20%20%20%20B%20--%3E%20C%5Bservice.yaml%5Cnname%2C%20codename%2C%20image%5Cnports%2C%20health%2C%20depends_on%5D%0A%20%20%20%20C%20--%3E%20D%5Boracle.mk%20%2F%20cerebro.mk%20%2F%20tardis.mk%5Cnup%20%C2%B7%20down%20%C2%B7%20health%20%C2%B7%20logs%5Cnbuild%20%C2%B7%20push%20%C2%B7%20publish%20%C2%B7%20tag%5Cnclean%20%C2%B7%20nuke%20%C2%B7%20help%5D%0A"})]),fallback:a(()=>[...s[0]||(s[0]=[i(" Loading... ",-1)])]),_:1})),s[5]||(s[5]=p("h3",{id:"runtime-topology",tabindex:"-1"},[i("Runtime topology "),p("a",{class:"header-anchor",href:"#runtime-topology","aria-label":'Permalink to "Runtime topology"'},"​")],-1)),(e(),n(r,null,{default:a(()=>[l(t,{id:"mermaid-194",class:"mermaid",graph:"graph%20TB%0A%20%20%20%20subgraph%20Host%0A%20%20%20%20%20%20%20%20subgraph%20arc_platform_net%20%5Barc_platform_net%20%E2%80%94%20external%20bridge%2C%20pre-existing%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20oracle%5B%22arc-sql-db%5Cnpostgres%3A17-alpine%5Cn%3A5432%22%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20cerebro%5B%22arc-vector-db%5Cnqdrant%2Fqdrant%5Cn%3A6333%20REST%20%C2%B7%20%3A6334%20gRPC%22%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20tardis%5B%22arc-storage%5Cnminio%2Fminio%5Cn%3A9000%20S3%20%C2%B7%20%3A9001%20console%22%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20cortex%5B%22arc-cortex%5Cn%3A8081%22%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20flash%5B%22arc-messaging%5Cn%3A4222%22%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20sonic%5B%22arc-cache%5Cn%3A6379%22%5D%0A%20%20%20%20%20%20%20%20end%0A%20%20%20%20end%0A%0A%20%20%20%20cortex%20--%20%22sql%20bootstrap%5Cnpg%20wire%20%3A5432%22%20--%3E%20oracle%0A%20%20%20%20mystique_future%5B%22arc-flags%20(future)%22%5D%20-.%20%22pg%20%3A5432%22%20.-%3E%20oracle%0A%20%20%20%20sherlock_future%5B%22arc-sherlock%20(future)%22%5D%20-.%20%22vector%20%3A6333%22%20.-%3E%20cerebro%0A%20%20%20%20scarlett_future%5B%22arc-scarlett%20(future)%22%5D%20-.%20%22s3%20%3A9000%22%20.-%3E%20tardis%0A"})]),fallback:a(()=>[...s[1]||(s[1]=[i(" Loading... ",-1)])]),_:1})),s[6]||(s[6]=p("h3",{id:"volume-layout",tabindex:"-1"},[i("Volume layout "),p("a",{class:"header-anchor",href:"#volume-layout","aria-label":'Permalink to "Volume layout"'},"​")],-1)),(e(),n(r,null,{default:a(()=>[l(t,{id:"mermaid-198",class:"mermaid",graph:"graph%20LR%0A%20%20%20%20oracle_c%5B%22arc-sql-db%5Cncontainer%22%5D%20---%20oracle_v%5B%22arc-sql-db-data%5Cn%2Fvar%2Flib%2Fpostgresql%2Fdata%22%5D%0A%20%20%20%20cerebro_c%5B%22arc-vector-db%5Cncontainer%22%5D%20---%20cerebro_v%5B%22arc-vector-db-data%5Cn%2Fqdrant%2Fstorage%22%5D%0A%20%20%20%20tardis_c%5B%22arc-storage%5Cncontainer%22%5D%20---%20tardis_v%5B%22arc-storage-data%5Cn%2Fdata%22%5D%0A"})]),fallback:a(()=>[...s[2]||(s[2]=[i(" Loading... ",-1)])]),_:1})),s[7]||(s[7]=d(`<h2 id="constitution-check" tabindex="-1">Constitution Check <a class="header-anchor" href="#constitution-check" aria-label="Permalink to &quot;Constitution Check&quot;">​</a></h2><table tabindex="0"><thead><tr><th>#</th><th>Principle</th><th>Status</th><th>Evidence</th></tr></thead><tbody><tr><td>I</td><td>Zero-Dep CLI</td><td>N/A</td><td>No CLI changes</td></tr><tr><td>II</td><td>Platform-in-a-Box</td><td>PASS</td><td><code>make data-up</code> boots all three; oracle + cerebro join <code>think</code> profile</td></tr><tr><td>III</td><td>Modular Services</td><td>PASS</td><td>Each in own dir under <code>services/</code>; self-contained with own service.yaml</td></tr><tr><td>IV</td><td>Two-Brain</td><td>PASS</td><td>Config-only upstream images — no language concern</td></tr><tr><td>V</td><td>Polyglot Standards</td><td>PASS</td><td>Same Dockerfile/compose/healthcheck structure as 003-messaging-setup</td></tr><tr><td>VI</td><td>Local-First</td><td>N/A</td><td>CLI only</td></tr><tr><td>VII</td><td>Observability</td><td>PASS</td><td>pg_isready, Qdrant /readyz, MinIO /health/live; Prometheus scraping deferred (TD-001)</td></tr><tr><td>VIII</td><td>Security</td><td>PASS</td><td>postgres uid 70, qdrant uid 1000; MinIO uid verified (see Decision 3); 127.0.0.1 ports; no secrets in git</td></tr><tr><td>IX</td><td>Declarative</td><td>N/A</td><td>CLI only</td></tr><tr><td>X</td><td>Stateful Ops</td><td>N/A</td><td>CLI only</td></tr><tr><td>XI</td><td>Resilience</td><td>PASS</td><td>Health checks with appropriate start_periods; named volumes survive restart</td></tr><tr><td>XII</td><td>Interactive</td><td>N/A</td><td>CLI only</td></tr></tbody></table><h2 id="project-structure" tabindex="-1">Project Structure <a class="header-anchor" href="#project-structure" aria-label="Permalink to &quot;Project Structure&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>arc-platform/</span></span>
<span class="line"><span>├── services/</span></span>
<span class="line"><span>│   ├── persistence/                          ← NEW (Oracle / Postgres 17)</span></span>
<span class="line"><span>│   │   ├── Dockerfile                        # FROM postgres:17-alpine; OCI + arc labels; uid 70 (postgres)</span></span>
<span class="line"><span>│   │   ├── service.yaml                      # name, codename, image, ports, health</span></span>
<span class="line"><span>│   │   ├── docker-compose.yml                # arc-sql-db; POSTGRES_* env; named volume; arc_platform_net</span></span>
<span class="line"><span>│   │   └── oracle.mk                         # oracle-up/down/health/logs/build/push/publish/tag/clean/nuke</span></span>
<span class="line"><span>│   ├── vector/                               ← NEW (Cerebro / Qdrant)</span></span>
<span class="line"><span>│   │   ├── Dockerfile                        # FROM qdrant/qdrant; OCI + arc labels; uid 1000</span></span>
<span class="line"><span>│   │   ├── service.yaml</span></span>
<span class="line"><span>│   │   ├── docker-compose.yml                # arc-vector-db; :6333/:6334; named volume; arc_platform_net</span></span>
<span class="line"><span>│   │   └── cerebro.mk</span></span>
<span class="line"><span>│   ├── storage/                              ← NEW (Tardis / MinIO)</span></span>
<span class="line"><span>│   │   ├── Dockerfile                        # FROM minio/minio; OCI + arc labels; uid verified</span></span>
<span class="line"><span>│   │   ├── service.yaml</span></span>
<span class="line"><span>│   │   ├── docker-compose.yml                # arc-storage; :9000/:9001; MINIO_ROOT_*; named volume; arc_platform_net</span></span>
<span class="line"><span>│   │   └── tardis.mk</span></span>
<span class="line"><span>│   ├── profiles.yaml                         # MODIFY — think += oracle, cerebro; reason += tardis</span></span>
<span class="line"><span>│   └── data.mk                               ← NEW (aggregate)</span></span>
<span class="line"><span>├── .github/workflows/</span></span>
<span class="line"><span>│   ├── data-images.yml                       ← NEW</span></span>
<span class="line"><span>│   └── data-release.yml                      ← NEW</span></span>
<span class="line"><span>└── Makefile                                  # MODIFY — include oracle.mk, cerebro.mk, tardis.mk, data.mk</span></span></code></pre></div><h2 id="key-implementation-decisions" tabindex="-1">Key Implementation Decisions <a class="header-anchor" href="#key-implementation-decisions" aria-label="Permalink to &quot;Key Implementation Decisions&quot;">​</a></h2><h3 id="_1-dockerfiles-are-thin-label-wrappers-same-as-003" tabindex="-1">1. Dockerfiles are thin label wrappers (same as 003) <a class="header-anchor" href="#_1-dockerfiles-are-thin-label-wrappers-same-as-003" aria-label="Permalink to &quot;1. Dockerfiles are thin label wrappers (same as 003)&quot;">​</a></h3><p>No config baked in. All service configuration is in <code>docker-compose.yml</code> via command-line flags or environment variables. The Dockerfile only pins the upstream image and adds labels.</p><div class="language-dockerfile vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># services/persistence/Dockerfile</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> postgres:17-alpine</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LABEL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> org.opencontainers.image.title=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ARC Oracle — Persistence&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LABEL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> org.opencontainers.image.description=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Postgres 17 relational database for the A.R.C. Platform&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LABEL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> org.opencontainers.image.source=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://github.com/arc-framework/arc-platform&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LABEL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> arc.service.name=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;arc-sql-db&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LABEL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> arc.service.codename=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;oracle&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LABEL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> arc.service.tech=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;postgres&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># postgres:17-alpine already runs as postgres user (uid 70) — no USER directive needed</span></span></code></pre></div><div class="language-dockerfile vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># services/vector/Dockerfile</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> qdrant/qdrant</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LABEL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> org.opencontainers.image.title=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ARC Cerebro — Vector Store&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LABEL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> arc.service.codename=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cerebro&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LABEL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> arc.service.tech=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;qdrant&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># qdrant/qdrant runs as uid 1000 — non-root by default</span></span></code></pre></div><div class="language-dockerfile vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># services/storage/Dockerfile</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> minio/minio</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LABEL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> org.opencontainers.image.title=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ARC Tardis — Object Storage&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LABEL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> arc.service.codename=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;tardis&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LABEL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> arc.service.tech=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;minio&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># minio/minio: verify uid at build time — document if root deviation applies</span></span></code></pre></div><h3 id="_2-arc-platform-net-as-external-network-same-as-003" tabindex="-1">2. arc_platform_net as external network (same as 003) <a class="header-anchor" href="#_2-arc-platform-net-as-external-network-same-as-003" aria-label="Permalink to &quot;2. arc_platform_net as external network (same as 003)&quot;">​</a></h3><p>Each <code>docker-compose.yml</code> declares the network as external. The network is created once by <code>make dev</code> or <code>make flash-up</code>. <code>data.mk</code>&#39;s <code>data-up</code> target ensures it exists with <code>|| true</code>.</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Bottom of every docker-compose.yml in this spec</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">networks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  arc_platform_net</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    external</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">arc_platform_net</span></span></code></pre></div><h3 id="_3-minio-non-root-handling" tabindex="-1">3. MinIO non-root handling <a class="header-anchor" href="#_3-minio-non-root-handling" aria-label="Permalink to &quot;3. MinIO non-root handling&quot;">​</a></h3><p><code>minio/minio</code> standard image runs as root by default. Options in order of preference:</p><ul><li><strong>Option A</strong>: Use <code>user: &quot;1000:1000&quot;</code> in docker-compose and ensure <code>/data</code> is writable — verify MinIO supports this without a custom Dockerfile</li><li><strong>Option B</strong>: Add <code>RUN mkdir -p /data &amp;&amp; chown 1000:1000 /data &amp;&amp; adduser -u 1000 minio</code> in Dockerfile and <code>USER 1000</code></li></ul><p>If neither works with the upstream image, document the root deviation in docker-compose.yml comments (same as Pulsar in 003).</p><h3 id="_4-postgres-docker-compose-pattern" tabindex="-1">4. Postgres docker-compose pattern <a class="header-anchor" href="#_4-postgres-docker-compose-pattern" aria-label="Permalink to &quot;4. Postgres docker-compose pattern&quot;">​</a></h3><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  arc-sql-db</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">dockerfile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Dockerfile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ghcr.io/arc-framework/arc-sql-db:latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    container_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">arc-sql-db</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    environment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      POSTGRES_USER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">arc</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      POSTGRES_PASSWORD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">arc</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      POSTGRES_DB</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">arc</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;127.0.0.1:5432:5432&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">oracle-data:/var/lib/postgresql/data</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    healthcheck</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;CMD-SHELL&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;pg_isready -U arc || exit 1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      interval</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">5s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      timeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">3s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      retries</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      start_period</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">10s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    networks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">arc_platform_net</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    restart</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">unless-stopped</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  oracle-data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">arc-sql-db-data</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">networks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  arc_platform_net</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    external</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">arc_platform_net</span></span></code></pre></div><h3 id="_5-qdrant-docker-compose-pattern" tabindex="-1">5. Qdrant docker-compose pattern <a class="header-anchor" href="#_5-qdrant-docker-compose-pattern" aria-label="Permalink to &quot;5. Qdrant docker-compose pattern&quot;">​</a></h3><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  arc-vector-db</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ghcr.io/arc-framework/arc-vector-db:latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    container_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">arc-vector-db</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;127.0.0.1:6333:6333&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   # REST + Prometheus metrics</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;127.0.0.1:6334:6334&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   # gRPC</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">cerebro-data:/qdrant/storage</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    healthcheck</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;CMD-SHELL&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;wget -qO- http://localhost:6333/readyz || exit 1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      interval</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">5s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      timeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">3s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      retries</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      start_period</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">5s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    networks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">arc_platform_net</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    restart</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">unless-stopped</span></span></code></pre></div><h3 id="_6-minio-docker-compose-pattern" tabindex="-1">6. MinIO docker-compose pattern <a class="header-anchor" href="#_6-minio-docker-compose-pattern" aria-label="Permalink to &quot;6. MinIO docker-compose pattern&quot;">​</a></h3><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  arc-storage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ghcr.io/arc-framework/arc-storage:latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    container_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">arc-storage</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    command</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">server /data --console-address &quot;:9001&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    environment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      MINIO_ROOT_USER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">arc</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      MINIO_ROOT_PASSWORD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">arc-minio-dev</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;127.0.0.1:9000:9000&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   # S3 API</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;127.0.0.1:9001:9001&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   # Web console</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">tardis-data:/data</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    healthcheck</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;CMD-SHELL&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;curl -f http://localhost:9000/minio/health/live || exit 1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      interval</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">10s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      timeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">5s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      retries</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      start_period</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">10s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    networks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">arc_platform_net</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    restart</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">unless-stopped</span></span></code></pre></div><h3 id="_7-data-mk-aggregate-mirrors-messaging-mk" tabindex="-1">7. data.mk aggregate (mirrors messaging.mk) <a class="header-anchor" href="#_7-data-mk-aggregate-mirrors-messaging-mk" aria-label="Permalink to &quot;7. data.mk aggregate (mirrors messaging.mk)&quot;">​</a></h3><div class="language-makefile vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">makefile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PHONY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: data-help data-up data-down data-health data-logs</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## data-up: Start all data services (Oracle + Cerebro + Tardis)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">data-up</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	@</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">docker network create arc_platform_net 2&gt;/dev/null || true</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	$(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MAKE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> oracle-up --no-print-directory</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	$(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MAKE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cerebro-up --no-print-directory</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	$(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MAKE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tardis-up --no-print-directory</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## data-down: Stop all data services</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">data-down</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	$(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MAKE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> oracle-down --no-print-directory</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	$(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MAKE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cerebro-down --no-print-directory</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	$(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MAKE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tardis-down --no-print-directory</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## data-health: Check health of all three data services</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">data-health</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	@</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">$(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MAKE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> oracle-health --no-print-directory &amp;&amp; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	 $(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MAKE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cerebro-health --no-print-directory &amp;&amp; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	 $(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MAKE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tardis-health --no-print-directory</span></span></code></pre></div><h3 id="_8-ci-workflow-—-mirrors-messaging-images-yml-exactly" tabindex="-1">8. CI workflow — mirrors messaging-images.yml exactly <a class="header-anchor" href="#_8-ci-workflow-—-mirrors-messaging-images-yml-exactly" aria-label="Permalink to &quot;8. CI workflow — mirrors messaging-images.yml exactly&quot;">​</a></h3><p><code>data-images.yml</code> uses <code>_reusable-build.yml</code> and <code>_reusable-security.yml</code> with path filters:</p><ul><li><code>services/persistence/**</code> → build-oracle</li><li><code>services/vector/**</code> → build-cerebro</li><li><code>services/storage/**</code> → build-tardis</li></ul><p><code>data-release.yml</code> tag format: <code>data/vX.Y.Z</code> → Docker tag <code>data-vX.Y.Z</code></p><h2 id="parallel-execution-strategy" tabindex="-1">Parallel Execution Strategy <a class="header-anchor" href="#parallel-execution-strategy" aria-label="Permalink to &quot;Parallel Execution Strategy&quot;">​</a></h2>`,30)),(e(),n(r,null,{default:a(()=>[l(t,{id:"mermaid-479",class:"mermaid",graph:"gantt%0A%20%20%20%20title%20005-data-layer%20Implementation%20Phases%0A%20%20%20%20dateFormat%20X%0A%20%20%20%20axisFormat%20%25s%0A%0A%20%20%20%20section%20Phase%201%20%E2%80%94%20Foundation%0A%20%20%20%20Update%20profiles.yaml%20(oracle%2Bcerebro%E2%86%92think%2C%20tardis%E2%86%92reason)%20%20%3Ap1%2C%200%2C%201%0A%0A%20%20%20%20section%20Phase%202%20%E2%80%94%20Services%20(fully%20parallel)%0A%20%20%20%20persistence%2F%3A%20Dockerfile%20%2B%20service.yaml%20%2B%20compose%20%20%20%20%20%20%20%20%20%20%20%20%3Ap2a%2C%20after%20p1%2C%202%0A%20%20%20%20vector%2F%3A%20Dockerfile%20%2B%20service.yaml%20%2B%20compose%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ap2b%2C%20after%20p1%2C%202%0A%20%20%20%20storage%2F%3A%20Dockerfile%20%2B%20service.yaml%20%2B%20compose%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ap2c%2C%20after%20p1%2C%202%0A%0A%20%20%20%20section%20Phase%203%20%E2%80%94%20Make%20targets%20(parallel%20per%20service)%0A%20%20%20%20oracle.mk%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ap3a%2C%20after%20p2a%2C%201%0A%20%20%20%20cerebro.mk%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ap3b%2C%20after%20p2b%2C%201%0A%20%20%20%20tardis.mk%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ap3c%2C%20after%20p2c%2C%201%0A%20%20%20%20data.mk%20aggregate%20%2B%20Makefile%20includes%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ap3d%2C%20after%20p2c%2C%201%0A%0A%20%20%20%20section%20Phase%204%20%E2%80%94%20CI%2FCD%20(parallel)%0A%20%20%20%20data-images.yml%20workflow%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ap4a%2C%20after%20p3d%2C%202%0A%20%20%20%20data-release.yml%20workflow%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ap4b%2C%20after%20p3d%2C%202%0A%0A%20%20%20%20section%20Phase%205%20%E2%80%94%20Integration%0A%20%20%20%20make%20data-up%20%2B%20make%20data-health%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ap5%2C%20after%20p4b%2C%201%0A%20%20%20%20Cortex%20%2Fhealth%2Fdeep%20shows%20oracle%20ok%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ap5b%2C%20after%20p5%2C%201%0A"})]),fallback:a(()=>[...s[3]||(s[3]=[i(" Loading... ",-1)])]),_:1})),s[8]||(s[8]=d('<p><strong>Parallelizable task groups:</strong></p><ul><li>Phase 2: All three service directories are fully independent</li><li>Phase 3: oracle.mk + cerebro.mk + tardis.mk — independent after their Phase 2 deps</li><li>Phase 4: data-images.yml + data-release.yml — independent of each other</li></ul><h2 id="tech-debt" tabindex="-1">Tech Debt <a class="header-anchor" href="#tech-debt" aria-label="Permalink to &quot;Tech Debt&quot;">​</a></h2><table tabindex="0"><thead><tr><th>ID</th><th>Item</th><th>Rationale</th></tr></thead><tbody><tr><td>TD-001</td><td>Qdrant Prometheus scraping via otel collector</td><td>Qdrant exposes <code>/metrics</code> on :6333. When a concrete dashboard requirement exists, add a <code>prometheus</code> scrape job for <code>arc-vector-db:6333</code> to the collector config (see 003 pattern).</td></tr><tr><td>TD-002</td><td>MinIO Prometheus scraping</td><td>MinIO exports metrics at <code>:9000/minio/v2/metrics/cluster</code>. Same deferral as TD-001.</td></tr><tr><td>TD-003</td><td>Default bucket creation</td><td>MinIO starts empty. Cortex bootstrap (or a future init task) should create standard buckets (<code>arc-artifacts</code>, <code>arc-models</code>, etc.) via <code>mc</code> client.</td></tr></tbody></table><h2 id="reviewer-checklist" tabindex="-1">Reviewer Checklist <a class="header-anchor" href="#reviewer-checklist" aria-label="Permalink to &quot;Reviewer Checklist&quot;">​</a></h2><ul><li>[ ] <code>make data-up</code> exits 0; all three containers in <code>healthy</code> state (<code>docker compose ps</code>)</li><li>[ ] <code>make data-health</code> exits 0</li><li>[ ] <code>make data-down</code> stops all three; no orphaned containers</li><li>[ ] <code>make oracle-up &amp;&amp; make oracle-health</code> works independently</li><li>[ ] <code>make cerebro-up &amp;&amp; make cerebro-health</code> works independently</li><li>[ ] <code>make tardis-up &amp;&amp; make tardis-health</code> works independently</li><li>[ ] <code>curl -s http://localhost:8081/health/deep | jq .oracle.status</code> returns <code>&quot;ok&quot;</code> after cortex restart</li><li>[ ] <code>curl -s http://localhost:6333/readyz</code> returns HTTP 200</li><li>[ ] <code>curl -s http://localhost:9000/minio/health/live</code> returns HTTP 200</li><li>[ ] <code>docker inspect arc-sql-db | jq &#39;.[0].Config.User&#39;</code> confirms non-root (empty = postgres default uid 70)</li><li>[ ] <code>docker inspect arc-vector-db | jq &#39;.[0].Config.User&#39;</code> confirms non-root (uid 1000)</li><li>[ ] MinIO uid documented (non-root or deviation noted in compose comments)</li><li>[ ] All ports bind <code>127.0.0.1</code> — verify with <code>docker compose ps</code></li><li>[ ] All volumes are named (not bind mounts) — <code>docker volume ls | grep arc</code></li><li>[ ] <code>services/profiles.yaml</code> <code>think</code> includes <code>oracle</code> + <code>cerebro</code>; <code>reason</code> includes <code>tardis</code></li><li>[ ] <code>Makefile</code> includes oracle.mk, cerebro.mk, tardis.mk, data.mk</li><li>[ ] <code>data-images.yml</code> runs only on relevant path changes; path filters cover all three service dirs</li><li>[ ] <code>data-release.yml</code> tag format <code>data/v*</code> builds multi-platform images (amd64 + arm64)</li><li>[ ] All Dockerfiles have OCI + <code>arc.service.*</code> labels</li><li>[ ] No credentials or secrets in any compose file (use env vars with dev defaults)</li><li>[ ] <code>make oracle-clean</code> and <code>make oracle-nuke</code> prompt for confirmation before destructive action</li></ul><h2 id="risks-mitigations" tabindex="-1">Risks &amp; Mitigations <a class="header-anchor" href="#risks-mitigations" aria-label="Permalink to &quot;Risks &amp; Mitigations&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Risk</th><th>Impact</th><th>Mitigation</th></tr></thead><tbody><tr><td>MinIO runs as root in upstream image</td><td>M</td><td>Verify at implementation time; either <code>user: &quot;1000:1000&quot;</code> in compose or document deviation in comments (like Pulsar)</td></tr><tr><td><code>arc_platform_net</code> not created before <code>make data-up</code></td><td>H</td><td><code>data-up</code> calls <code>docker network create arc_platform_net 2&gt;/dev/null || true</code> first</td></tr><tr><td>Postgres ignores env vars after data dir is initialized</td><td>M</td><td>Document in <code>make oracle-clean</code> help text; <code>oracle-nuke</code> removes the volume</td></tr><tr><td>Cortex fails to connect to Oracle if password mismatch with Cortex config</td><td>M</td><td>Cortex default Postgres password in <code>cortex.mk</code> env vars must match <code>POSTGRES_PASSWORD=arc</code></td></tr><tr><td>Port 5432 conflict with a local Postgres installation</td><td>L</td><td>Document in oracle.mk help; user can override host port via compose override file</td></tr></tbody></table>',8))])}const b=h(c,[["render",E]]);export{A as __pageData,b as default};
