name: arc-platform

services:
  arc-vault:
    build:
      context: .
      dockerfile: Dockerfile
    image: ghcr.io/arc-framework/arc-vault:latest
    container_name: arc-vault
    command: server -dev
    environment:
      VAULT_DEV_ROOT_TOKEN_ID: arc-dev-token
      VAULT_DEV_LISTEN_ADDRESS: 0.0.0.0:8200
    ports:
      - "127.0.0.1:8200:8200"   # OpenBao API â€” localhost only
    healthcheck:
      test: ["CMD-SHELL", "bash -c 'exec 3<>/dev/tcp/localhost/8200; printf \"GET /v1/sys/health HTTP/1.0\\r\\nHost: localhost\\r\\n\\r\\n\" >&3; head -1 <&3 | grep -q 200' || exit 1"]
      interval: 5s
      timeout: 3s
      retries: 5
      start_period: 5s
    networks:
      - arc_platform_net
    restart: unless-stopped

networks:
  arc_platform_net:
    external: true
    name: arc_platform_net
